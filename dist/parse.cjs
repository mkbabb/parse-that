"use strict";var L=Object.defineProperty;var M=(s,e,t)=>e in s?L(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var E=(s,e,t)=>(M(s,typeof e!="symbol"?e+"":e,t),t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});class w{constructor(e,t=void 0,r=0,i=!1){this.src=e,this.value=t,this.offset=r,this.isError=i}ok(e,t=0){return new w(this.src,e,this.offset+t)}err(e,t=0){const r=this.ok(e,t);return r.isError=!0,r}from(e,t=0){return new w(this.src,e,this.offset+t,this.isError)}getColumnNumber(){const e=this.offset,t=this.src.lastIndexOf(`
`,e),r=t===-1?e:e-(t+1);return Math.max(0,r)}getLineNumber(){const t=this.src.slice(0,this.offset).split(`
`).length-1;return Math.max(0,t)}}function o(s,e,...t){return{name:s,parser:e,args:t}}let j=0;const h=new Map,p=new Map;function x(s){return s.parser?s.parser:s.parser=s()}class c{constructor(e,t={}){E(this,"id",j++);this.parser=e,this.context=t}parse(e){return h.clear(),p.clear(),this.parser(new w(e)).value}getCijKey(e){return`${this.id}${e.offset}`}atLeftRecursionLimit(e){return(p.get(this.getCijKey(e))??0)>e.src.length-e.offset}memoize(){const e=t=>{const r=this.getCijKey(t),i=p.get(r)??0;let n=h.get(this.id);if(n&&n.offset>=t.offset)return n;if(this.atLeftRecursionLimit(t))return t.err(void 0);p.set(r,i+1);const u=this.parser(t);return n=h.get(this.id),n&&n.offset>u.offset?u.offset=n.offset:n||h.set(this.id,u),u};return new c(e,o("memoize",this))}mergeMemos(){const e=t=>{let r=h.get(this.id);if(r)return r;if(this.atLeftRecursionLimit(t))return t.err(void 0);const i=this.parser(t);return r=h.get(this.id),r||h.set(this.id,i),i};return new c(e,o("mergeMemo",this))}then(e){if(l(this,e))return g([this,e],"",r=>[r==null?void 0:r[0],r==null?void 0:r[1]]);const t=r=>{const i=this.parser(r);if(!i.isError){const n=e.parser(i);if(!n.isError)return n.ok([i.value,n.value])}return r.err(void 0)};return new c(t,o("then",this,this,e))}or(e){if(l(this,e))return g([this,e],"|");const t=r=>{const i=this.parser(r);return i.isError?e.parser(r):i};return new c(t,o("or",this,this,e))}chain(e,t=!1){const r=i=>{const n=this.parser(i);return n.isError?n:n.value||t?e(n.value).parser(n):i};return new c(r,o("chain",this,e))}map(e,t=!1){const r=i=>{const n=this.parser(i);return!n.isError||t?n.ok(e(n.value)):n};return new c(r,o("map",this))}mapState(e){const t=r=>{const i=this.parser(r);return e(i)};return new c(t,o("mapState",this))}skip(e){const t=r=>{const i=this.parser(r);if(!i.isError){const n=e.parser(i);if(!n.isError)return n.ok(i.value)}return r.err(void 0)};return new c(t,o("skip",this,e))}next(e){const t=this.then(e).map(([,r])=>r);return t.context=o("next",this,e),t}opt(){const e=t=>{const r=this.parser(t);return r.isError?t.ok(void 0):r};return new c(e,o("opt",this))}not(e){const t=i=>this.parser(i).isError?i.ok(i.value):i.err(void 0),r=i=>{const n=this.parser(i);return n.isError||e.parser(i).isError?n:i.err(void 0)};return new c(e?r:t,o("not",this,e))}wrap(e,t,r=!0){if(!r)return v(e,this,t);if(l(e,this,t))return I(e,this,t);const i=e.next(this).skip(t);return i.context=o("wrap",this,e,t),i}trim(e=m,t=!0){var r;if(!t)return v(e,this,e);if(((r=e.context)==null?void 0:r.name)==="whitespace"){if(l(this,e))return g([e,this,e],"",n=>n==null?void 0:n[2]);const i=n=>{const u=z(n),f=this.parser(u);return f.isError?n.err(void 0):z(f)};return new c(i,o("trimWhitespace",this))}return this.wrap(e,e)}many(e=0,t=1/0){const r=i=>{const n=[];let u=i;for(let f=0;f<t;f+=1){const a=this.parser(u);if(a.isError)break;n.push(a.value),u=a}return n.length>=e?u.ok(n):i.err([])};return new c(r,o("many",this,e,t))}sepBy(e,t=0,r=1/0){const i=n=>{const u=[];let f=n;for(let a=0;a<r;a+=1){const d=this.parser(f);if(d.isError)break;f=d,u.push(f.value);const y=e.parser(f);if(y.isError)break;f=y}return u.length>t?f.ok(u):n.err([])};return new c(i,o("sepBy",this,e))}eof(){const e=this.skip(b());return e.context=o("eof",this),e}toString(){var e;return(e=this.context)==null?void 0:e.name}static lazy(e){const t=r=>x(e).parser(r);return new c(t,o("lazy",void 0,e))}}function l(...s){return s.every(e=>{var t,r,i,n;return(((t=e.context)==null?void 0:t.name)==="string"||((r=e.context)==null?void 0:r.name)==="regex"||((i=e.context)==null?void 0:i.name)==="whitespace")&&((n=e.context)==null?void 0:n.args)})}function C(s){var e,t,r,i,n;if(((e=s.context)==null?void 0:e.name)==="string")return(t=s.context)==null?void 0:t.args[0].replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");if(((r=s.context)==null?void 0:r.name)==="regex"||((i=s.context)==null?void 0:i.name)==="whitespace")return(n=s.context)==null?void 0:n.args[0].source}function g(s,e="",t){const r=s.map(u=>`(${C(u)})`).join(e),i=new RegExp(r),n=S(i,t);return e!=="|"&&(n.context=o("regexConcat",this,i)),n}function I(s,e,t){const r=g([s,e,t],"",i=>i==null?void 0:i[2]);return r.context.name="regexWrap",r}function b(){const s=e=>e.offset>=e.src.length?e.ok(void 0):e.err();return new c(s,o("eof",void 0))}function R(s,e,t){const r=t.value.bind(s);t.value=function(){const i=n=>x(r).parser(n);return new c(i,o("lazy",void 0,r))}}function N(...s){if(l(...s))return g(s,"|");const e=t=>{for(const r of s){const i=r.parser(t);if(!i.isError)return i}return t.err(void 0)};return new c(s.length===1?s[0].parser:e,o("any",void 0,...s))}function v(...s){const e=t=>{const r=[];for(const i of s){const n=i.parser(t);if(n.isError)return n;n.value!==void 0&&r.push(n.value),t=n}return t.ok(r)};return new c(s.length===1?s[0].parser:e,o("all",void 0,...s))}function O(s){const e=t=>{if(t.offset>=t.src.length)return t.err(void 0);const r=t.src.slice(t.offset,t.offset+s.length);return r===s?t.ok(r,r.length):t.err(void 0)};return new c(e,o("string",void 0,s))}function S(s,e=t=>t==null?void 0:t[0]){const t=s.flags.replace(/y/g,""),r=new RegExp(s,t+"y"),i=n=>{if(n.offset>=n.src.length)return n.err(void 0);r.lastIndex=n.offset;const u=e(n.src.match(r));return u?n.ok(u,r.lastIndex-n.offset):u===""?n.ok(void 0):n.err(void 0)};return new c(i,o("regex",void 0,s))}const k=/\s*/y,z=s=>{var t;if(s.offset>=s.src.length)return s;k.lastIndex=s.offset;const e=((t=s.src.match(k))==null?void 0:t[0])??"";return s.ok(s.value,e.length)},m=S(/\s*/);m.context.name="whitespace";exports.Parser=c;exports.all=v;exports.any=N;exports.eof=b;exports.getLazyParser=x;exports.lazy=R;exports.regex=S;exports.string=O;exports.whitespace=m;
//# sourceMappingURL=parse.cjs.map
